# ギルド

チャンネルが複数集まったもの

---

## 定義

- ギルド(`guild`) の情報は`guilds` テーブルに保存する
  - ギルドに参加したメンバーは中間テーブルに保存する
- ギルドIDはSnowflakeとする
- ギルド名は32文字以下(bit数ではなく、文字数)とする (Unicode絵文字も含む)
- ユーザー(`user`):
  - インスタンスにアカウントが存在している、操作可能な概念(botユーザーも含む)
- メンバー(`member`): 
  - ギルドに参加しているユーザーのことを指す(ギルドごと)
- ギルドのオーナー(`owner`):
  - ギルドの所有権を持つメンバーで、各ギルドに1メンバー存在する
- メンバーアイコンはユーザーアイコンとは別に設定することが可能である
    - ユーザーアイコンをデフォルトアイコンとして使用する

---

- ギルドへの招待
    - ギルドに所属する、招待に関する権限(招待権限)を持ったメンバーのみが招待を発行できる。
    - 招待リンク
        - リンクを踏むことで、ギルドへ参加できるリンク
        - リンクの期限: 30分, 1時間, 3時間, 1日, 7日, 1ヶ月, 無期限
        - 使用回数の制限: 1回,5回,30回,100回,無制限
        - 参加しないという選択項目がある。
        - `invites` テーブルに発行ユーザーID,期限を書き込む
        - 招待権限を持ったユーザーは招待リンクを削除することが可能
            - 削除されると、`invites`のレコードが削除される

- ギルドからの脱退
    - 権限に関係なく、すべてのメンバーが自主的に脱退(`leave`)することができる
        - オーナーがギルドを脱退する場合、任意の他のユーザーにギルドの所有権を譲渡する必要がある
        - 譲渡するとレコードの`owner` カラムが更新される
    - ユーザーのキック
        - 権限を持っているユーザーは他のユーザーをキック(ギルドのメンバーから削除)することができる
        - 再度招待された場合は、ギルドに参加することが可能である
            - その際、キックされる前の設定(権限など)は引き継がれない
    - ユーザーのBAN
        - BANが実行されると`banned_members` テーブルにユーザーのレコードが作られ,レコードが存在するユーザーはギルドに参加できないようになる
        - 権限を持っているユーザーは他のユーザーをBAN(キックされ、BAN状態を解除されない限り再び参加できなくする)ことができる
            - BANが解除された場合は `banned_members` の該当レコードを削除する
        - どのような場合でもキック、BANを実行できないユーザーは以下の通り
            - 組み込みbotなど、Oshavery自体が必要とするシステムユーザー
            - そのギルドのオーナー

- ギルド内チャンネル
    - ギルドは１つ以上チャンネルを持つ
