# ユーザー

---

## 定義

- ユーザー(`user`)とは。インスタンスにアカウントが存在している、操作可能な概念(botユーザーも含む)
- メンバー(`member`)とは。ギルドに参加しているユーザーのことを指す(ギルドごと)
- ユーザーのIDは Snowflake とする
- ユーザーの情報は`user` テーブルに記録する

- パスワードは8文字以上の英数字と記号とする
- パスワードはargon2idでハッシュするものとする

- ユーザーのアイコンの保存等々はメディアで定義

- ユーザー登録には(有効な)メールアドレスとユーザー名(32文字以内)を必要とする


- ユーザーアカウントの削除
    - インスタンスの管理者はインスタンスのユーザーを凍結`suspend` できる
    - ユーザーの凍結が行われると、`suspend_users` テーブルにユーザーIDを書き込む
    - 凍結された場合、解除(レコードが削除)されるまでログインができなくなる
        - 同様にアクセストークンも失効する

---

### ユーザープロフィール

- ユーザープロフィールは `user_profiles` テーブルに保存する
- プロフィールは各ギルドにひも付き、固有のものが設定されていない場合はユーザーに紐付いている(デフォルト)プロフィールが使われる
    - デフォルトプロフィールはGuildId: `000000`  に紐づく(このIDは予約済みとする)


- ユーザーアイコンのファイル情報は`media`テーブルに保存する
- ユーザーステータス `user_status` カラムに保存する
    - ユーザーステータスは以下の3つとする(説明は明示的に指定されていない場合)
        - オンライン `online`: ユーザーがログインしている状態
        - 離席中 `idle`: ユーザーがログインしているが、5分間以上何の操作も行っていない状態
        - オフライン `offline`: ユーザーがログインしていない状態
    - ユーザーは他のユーザーから見えるユーザーステータスを3つの中から選択できる
    - カスタムステータス（オンライン状態）は下位状態にしか変更ができない（オフラインのときに、オンライン表示はできない）
    - ユーザーステータスメッセージ  `status_message`
        - ユーザーは3種類のステータスのほかに、短いメッセージ(ユーザーステータスメッセージ)を設定できる
        - ユーザーカスタムステータスは32文字以下とする